---
layout:     post
title:      Vuex
date:       2021-08-18
author:     PengPengQi
header-img: img/BackGround.png
catalog: true
tags:
    - Vuex
---
### Vuex
在Vue中实现**集中式状态管理的一个Vue插件**，对vue应用中**多个组件的共享状态进行集中式管理**，适用于任何组件间通信。
#### 使用场景
多个组件需要共享数据时
#### Vuex原理图
![Vuex原理图](https://raw.githubusercontent.com/PengPeng-Qi/PengPeng-Qi.github.io/main/img/vuex.png)

#### 搭建Vuex环境
1、创建文件：```src/store/index.js```
```js
//引入Vue核心库
import Vue from 'vue'
//引入Vuex
import Vuex from 'vuex'
//应用Vuex插件
Vue.use(Vuex)

//准备actions对象——响应组件中用户的动作
const actions = {}
//准备mutations对象——修改state中的数据
const mutations = {}
//准备state对象——保存具体的数据
const state = {}

//创建并暴露store
export default new Vuex.Store({
  actions,
  mutations,
  state
})
```
2、在`main.js`中创建vm时传入`store`配置项
```js
...
//引入store
import store from './store'
...

//创建vm
new Vue({
el:'#app',
render: h => h(App),
store
})
```
#### 基本使用
1、初始化数据、配置`actions`、配置`mutations`，操作文件`store.js`
```js
/* store/index.js */

// 引入Vue核心库
import Vue from 'vue'
// 引入Vuex
import Vuex from 'vuex'
// 引用Vuex
Vue.use(Vuex)

const actions = {
  // 响应组件中加的动作
  jia(context,value){
    // console.log('actions中的jia被调用了',miniStore,value)
    context.commit('JIA',value)
  },
}

const mutations = {
  // 执行加
  JIA(state,value){
    // console.log('mutations中的JIA被调用了',state,value)
    state.sum += value
  }
}

//初始化数据
const state = {
  sum:0
}

//创建并暴露store
export default new Vuex.Store({
  actions,
  mutations,
  state,
})
```
2、组件中读取`vuex`中的数据：`$store.state.sum`  
  
3、组件中修改`vuex`中的数据：`$store.dispatch('action中的方法名', 数据)` 或 `$store.commit('mutations中的方法名', 数据)`  
```js
/* Components */
methods: {
  decrement(){
    this.$store.commit('JIAN',this.n)
  },
  incrementOdd(){
    this.$store.dispatch('jiaOdd',this.n)
  },
}
```

> 备注：若没有网络请求或其他业务逻辑，组件中也可以越过`actions`，即不写`dispatch`，直接编写`commit`
  
#### getters的使用
1、概念：当`state` 中的**数据需要经过加工后再使用**时，可以使用`getters` 加工。
  
2、在`store.js` 中追加`getters` 配置
```js
/* store/index.js */
...
const getters = {
  bigSum(state){
    return state.sum * 10
  }
}

//创建并暴露store
export default new Vuex.Store({
  ...
  getters
})
```
3、组件中读取数据：`$store.getters.bigSum`
```html
<h3>当前求和放大10倍为：{{$store.getters.bigSum}}</h3>
```
#### 四个map方法的使用
需要先引入：`import {mapState, mapGetters} from 'vuex'`   
  
1、**mapState方法**：用于帮助我们映射`state`中的**数据为计算属性**
```js
computed: {
  //借助mapState生成计算属性：sum、school、subject（对象写法）
  ...mapState({sum:'sum',school:'school',subject:'subject'}),
      
  //借助mapState生成计算属性：sum、school、subject（数组写法）
  ...mapState(['sum','school','subject']),
},
```
2、**mapGetters方法**：用于帮助我们映射`getters`中的**数据为计算属性**
```js
computed: {
  //借助mapGetters生成计算属性：bigSum（对象写法）
  ...mapGetters({bigSum:'bigSum'}),

  //借助mapGetters生成计算属性：bigSum（数组写法）
  ...mapGetters(['bigSum'])
},
```
3、**mapActions方法**：用于帮助我们生成与`actions`对话的方法，即：包含`$store.dispatch(xxx)`的函数
```js
methods:{
  //靠mapActions生成：incrementOdd、incrementWait（对象形式）
  ...mapActions({incrementOdd:'jiaOdd',incrementWait:'jiaWait'})

  //靠mapActions生成：incrementOdd、incrementWait（数组形式）
  ...mapActions(['jiaOdd','jiaWait'])
}
```
4、**mapMutations方法**：用于帮助我们生成与`mutations`对话的方法，即：包含`$store.commit(xxx)`的函数
```js
methods:{
  //靠mapActions生成：increment、decrement（对象形式）
  ...mapMutations({increment:'JIA',decrement:'JIAN'}),
  
  //靠mapMutations生成：JIA、JIAN（对象形式）
  ...mapMutations(['JIA','JIAN']),
}
```
> 备注：`mapActions` 与`mapMutations` 使用时，若需要传递参数：在模板中绑定事件时传递好参数，否则参数是事件对象。

#### 模块化+命名空间
目的：让代码更好维护，让多种数据分类更加明确。
  
修改`store.js`：  
```js
const countAbout = {
  namespaced:true,  //开启命名空间
  state:{x:1},
  mutations: { ... },
  actions: { ... },
  getters: {
    bigSum(state){
      return state.sum * 10
    }
  }
}

const personAbout = {
  namespaced:true,  //开启命名空间
  state:{ ... },
  mutations: { ... },
  actions: { ... }
}

const store = new Vuex.Store({
  modules: {
    countAbout,
    personAbout
  }
})
```
开启命名空间后，组件中读取`state`数据：
```js
//方式一：自己直接读取
this.$store.state.personAbout.list

//方式二：借助mapState读取：
...mapState('countAbout',['sum','school','subject']),
```
开启命名空间后，组件中读取`getters`数据：
```js
//方式一：自己直接读取
this.$store.getters['personAbout/firstPersonName']

//方式二：借助mapGetters读取：
...mapGetters('countAbout',['bigSum'])
```
开启命名空间后，组件中调用`dispatch`
```js
//方式一：自己直接dispatch
this.$store.dispatch('personAbout/addPersonWang',person)

//方式二：借助mapActions：
...mapActions('countAbout',{incrementOdd:'jiaOdd',incrementWait:'jiaWait'})
```
开启命名空间后，组件中调用`commit`
```js
//方式一：自己直接commit
this.$store.commit('personAbout/ADD_PERSON',person)

//方式二：借助mapMutations：
...mapMutations('countAbout',{increment:'JIA',decrement:'JIAN'}),
```
